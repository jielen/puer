package com.ufgov.zc.server.zc;import java.io.StringWriter;import java.math.BigDecimal;import java.text.SimpleDateFormat;import java.util.ArrayList;import java.util.Collection;import java.util.Date;import java.util.HashMap;import java.util.Iterator;import java.util.List;import java.util.Map;import java.util.Set;import java.util.regex.Matcher;import java.util.regex.Pattern;import org.apache.velocity.VelocityContext;import org.apache.velocity.app.Velocity;import com.kingdrive.workflow.context.WorkflowContext;import com.kingdrive.workflow.model.runtime.ActionHistoryModel;import com.kingdrive.workflow.model.runtime.ActionModel;import com.kingdrive.workflow.model.runtime.CurrentTaskModel;import com.kingdrive.workflow.model.runtime.DraftModel;import com.kingdrive.workflow.model.runtime.InstanceModel;import com.kingdrive.workflow.model.runtime.StateValueModel;import com.kingdrive.workflow.service.db.WFRuntimeService;import com.ufgov.zc.common.commonbiz.model.WfAware;import com.ufgov.zc.common.console.model.AsEmp;import com.ufgov.zc.common.sf.model.SfEntrust;import com.ufgov.zc.common.sf.model.SfEntrustor;import com.ufgov.zc.common.sf.model.SfJdjg;import com.ufgov.zc.common.sf.model.SmsBoxsending;import com.ufgov.zc.common.system.RequestMeta;import com.ufgov.zc.common.system.constants.ZcSettingConstants;import com.ufgov.zc.common.system.dto.ElementConditionDto;import com.ufgov.zc.common.system.exception.BusinessException;import com.ufgov.zc.common.system.model.AsVal;import com.ufgov.zc.common.system.util.BeanUtil;import com.ufgov.zc.common.zc.model.SysEmp;import com.ufgov.zc.common.zc.model.ZcBaseBill;import com.ufgov.zc.server.sf.service.ISfEntrustService;import com.ufgov.zc.server.system.SpringContext;import com.ufgov.zc.server.system.service.IAsValService;import com.ufgov.zc.server.system.service.IUserService;import com.ufgov.zc.server.system.util.AsOptionUtil;import com.ufgov.zc.server.zc.service.IZcEbBaseService;public class ZcSUtil {  public final static String ENCODING_DEFAULT = "UTF-8";    static IZcEbBaseService  zcEbBaseService=(IZcEbBaseService)SpringContext.getBean("zcEbBaseService");    /**   * 鉴定机构列表   */ static List jdjgLst=new ArrayList();     public ZcSUtil(){//    zcEbBaseService=(IZcEbBaseService)SpringContext.getBean("zcEbBaseService");  }  public static void setBillDBDigest(List billList) {    for (int i = 0; i < billList.size(); i++) {      ZcBaseBill bill = (ZcBaseBill) billList.get(i);      bill.setDbDigest(bill.digest());    }  }  public static void checkConsistency(List currBeanList, List originalBeanList, String idFieldName) {    Map originalMap = new HashMap();    for (int i = 0; i < originalBeanList.size(); i++) {      ZcBaseBill temp = (ZcBaseBill) originalBeanList.get(i);      originalMap.put(BeanUtil.get(idFieldName, temp), temp);    }    StringBuffer deleteInfo = new StringBuffer("");    StringBuffer updateInfo = new StringBuffer("");    boolean isConsistent = true;    for (int i = 0; i < currBeanList.size(); i++) {      ZcBaseBill curr = (ZcBaseBill) currBeanList.get(i);      ZcBaseBill origin = (ZcBaseBill) originalMap.get(BeanUtil.get(idFieldName, curr));      if (origin == null) {        isConsistent = false;        deleteInfo.append(BeanUtil.get(idFieldName, curr) + ",");      } else {        if (!curr.getDbDigest().equals(origin.digest())) {          isConsistent = false;          updateInfo.append(BeanUtil.get(idFieldName, curr) + ",");        }      }    }    if (!isConsistent) {      String errorInfo = "";      if (deleteInfo.length() > 0) {        errorInfo += "id为：" + deleteInfo.substring(0, deleteInfo.lastIndexOf(",")) + "的数据已被删除.";      }      if (updateInfo.length() > 0) {        errorInfo += "\nid为：" + updateInfo.substring(0, updateInfo.lastIndexOf(",")) + "的数据已被修改.";      }      throw new BusinessException(errorInfo);    }  }  public static String checkConsistency(ZcBaseBill currBean, ZcBaseBill originalBean, String idFieldName) {    boolean isConsistent = true;    StringBuffer deleteInfo = new StringBuffer("");    StringBuffer updateInfo = new StringBuffer("");    String originalBeanDigest = null;    if (originalBean == null) {      isConsistent = false;      deleteInfo.append(BeanUtil.get(idFieldName, currBean) + ",");    } else {      originalBeanDigest = originalBean.digest();      if (!currBean.getDbDigest().equals(originalBeanDigest)) {        isConsistent = false;        updateInfo.append(BeanUtil.get(idFieldName, currBean) + ",");      }    }    if (!isConsistent) {      String errorInfo = "";      if (deleteInfo.length() > 0) {        errorInfo += "id为：" + deleteInfo.substring(0, deleteInfo.lastIndexOf(",")) + "的数据已被删除.";      }      if (updateInfo.length() > 0) {        errorInfo += "\nid为：" + updateInfo.substring(0, updateInfo.lastIndexOf(",")) + "的数据已被修改.";      }      throw new BusinessException(errorInfo);    }    return originalBeanDigest;  }  public static String checkConsistencyDirect(ZcBaseBill currBean, ZcBaseBill originalBean, String idFieldName) {    boolean isConsistent = true;    StringBuffer deleteInfo = new StringBuffer("");    StringBuffer updateInfo = new StringBuffer("");    String originalBeanDigest = null;    if (originalBean == null) {      isConsistent = false;      deleteInfo.append(BeanUtil.get(idFieldName, currBean) + ",");    } else {      originalBeanDigest = originalBean.getDbDigest();      if (!currBean.getDbDigest().equals(originalBeanDigest)) {        isConsistent = false;        updateInfo.append(BeanUtil.get(idFieldName, currBean) + ",");      }    }    if (!isConsistent) {      String errorInfo = "";      if (deleteInfo.length() > 0) {        errorInfo += "id为：" + deleteInfo.substring(0, deleteInfo.lastIndexOf(",")) + "的数据已被删除.";      }      if (updateInfo.length() > 0) {        errorInfo += "\nid为：" + updateInfo.substring(0, updateInfo.lastIndexOf(",")) + "的数据已被修改.";      }      throw new BusinessException(errorInfo);    }    return originalBeanDigest;  }  public static void checkDigest(ZcBaseBill currBean, ZcBaseBill originalBean, String idFieldName) {    String errorInfo = null;    boolean isConsistent = true;    if (originalBean == null) {      isConsistent = false;      errorInfo = "id为：" + BeanUtil.get(idFieldName, currBean) + "的数据已被删除.";    } else {      if (!currBean.getDbDigest().equals(originalBean.getDbDigest())) {        isConsistent = false;        errorInfo = "id为：" + BeanUtil.get(idFieldName, currBean) + "的数据已被修改.";      }    }    if (!isConsistent) {      throw new BusinessException(errorInfo);    }  }  /**   * @Description: (FieldToMod:数据库字段转JAVA字段)   * @return String 返回类型   * @since 1.0   */  public static String convertColumnToField(String inColumn) {    String field = "";    String[] strVals = inColumn.split("_");    for (int i = 0; i < strVals.length; i++) {      field += strVals[i].substring(0, 1) + strVals[i].substring(1).toLowerCase();    }    return (field.substring(0, 1).toLowerCase() + field.substring(1));  }  /**   * @Description: (FieldToMod:JAVA字段转数据库字段)   * @return String 返回类型   * @since 1.0   */  public static String convertFieldToColumn(String inField) {    String field = "";    for (int i = 0; i < inField.length(); i++) {      char c = inField.charAt(i);      if (Character.isUpperCase(c)) {        field = field.concat("_" + String.valueOf(c));      } else {        field = field.concat(String.valueOf(c));      }    }    return field.toUpperCase();  }  public static String safeString(Object o) {    return o == null ? "" : o.toString();  }  public static byte[] evaluate(Map contextMap, byte[] templateContext, String logTag, String encoding) throws Exception {    StringWriter sw = new StringWriter();    Velocity.init();    VelocityContext context = new VelocityContext();    Set set = contextMap.keySet();    Iterator iterator = set.iterator();    while (iterator.hasNext()) {      String key = (String) iterator.next();      Object value = (Object) contextMap.get(key);      context.put(key, value);    }    Velocity.evaluate(context, sw, logTag, new String(templateContext, encoding));    return sw.toString().getBytes(encoding);  }  /**   * 判断一个字符是Ascill字符还是其它字符（如汉，日，韩文字符）   *    * @param char   *            c, 需要判断的字符   * @return boolean, 返回true,Ascill字符   */  public static boolean isLetter(char c) {    int k = 0x80;    return c / k == 0 ? true : false;  }  /**   * 得到一个字符串的长度,显示的长度,一个汉字或日韩文长度为2,英文字符长度为1   *    * @param String   *            s ,需要得到长度的字符串   * @return int, 得到的字符串长度   */  public static int length(String s) {    if (s == null)      return 0;    char[] c = s.toCharArray();    int len = 0;    for (int i = 0; i < c.length; i++) {      len++;      if (!isLetter(c[i])) {        len++;      }    }    return len;  }  /**   * 截取一段字符的长度,不区分中英文,如果数字不正好，则少取一个字符位   *    * @author patriotlml   * @param String   *            origin, 原始字符串   * @param int   *            len, 截取长度(一个汉字长度按2算的)   * @return String, 返回的字符串   */  public static String substring(String origin, int len) {    return substring(origin, len, null);  }  public static String substring(String origin, int len, String fix) {    if (origin == null || origin.equals("") || len < 1)      return "";    byte[] strByte = new byte[len];    if (len >= length(origin)) {      return origin;    }    System.arraycopy(origin.getBytes(), 0, strByte, 0, len);    int count = 0;    for (int i = 0; i < len; i++) {      int value = (int) strByte[i];      if (value < 0) {        count++;      }    }    if (count % 2 != 0) {      len = (len == 1) ? ++len : --len;    }    return new String(strByte, 0, len) + fix;  }  /**   * 获取序列的下一个值   * @param sequenceName 序列名称，如果为空，则从通用序列中获取   * @return   * Administrator   * 2010-10-23   */  public static synchronized String getSequenceNextVal(String sequenceName) {    if (sequenceName == null || sequenceName.trim().equals("")) {      sequenceName = ZcSettingConstants.SEQUENCE_ZC_BASE;    }    // edit by kongqian 要从SpringContext里取，不能直接new//    IZcEbBaseService baseService = (IZcEbBaseService) SpringContext.getBean("zcEbBaseService");    return zcEbBaseService.getSequenceNextVal(sequenceName);  }  /**   * 获取序列的下一个值   * @param sequenceName 序列名称，如果为空，则从通用序列中获取   * @return   * Administrator   * 2010-10-23   */  public static synchronized String getNextVal(String sequenceName) {    if (sequenceName == null || sequenceName.trim().equals("")) {      sequenceName = "ZC_SEQ_BASE";    }//    IZcEbBaseService baseService = (IZcEbBaseService) SpringContext.getBean("zcEbBaseService");    return zcEbBaseService.getNextVal(sequenceName);  }  public static boolean isGys(RequestMeta requestMeta) {    // TCJLODO Auto-generated method stub    if(requestMeta.containRole(ZcSettingConstants.ROLE_GYS_HUIYUAN)      ||requestMeta.containRole(ZcSettingConstants.ROLE_GYS_NORMAL)      ||requestMeta.containRole(ZcSettingConstants.ROLE_GYS_QI_CHE_WEIXIU)      ||requestMeta.containRole(ZcSettingConstants.ROLE_GYS_QI_CHE_BAOXIAN)      ||requestMeta.containRole(ZcSettingConstants.ROLE_GYS_XIEYI)      ){      return true;    }          return false;  }  public static boolean isUseBi() {    // TCJLODO Auto-generated method stub    return "Y".equalsIgnoreCase(AsOptionUtil.getInstance().getOptionVal(ZcSettingConstants.OPT_ZC_USE_BUDGET_INTERFACE));  }  /**   * 获取工作流信息   * @param bill   * @return   */  public  ZcBaseBill getWorkFlowInfo(ZcBaseBill bill) {    // TCJLODO Auto-generated method stub    if(bill==null || bill.getProcessInstId()==null)return bill;        HashMap workflowMap=new HashMap();    WFRuntimeService wfService=(WFRuntimeService)SpringContext.getBean("WFRuntimeService");    //获取草稿 暂不获取草稿数据，因为数据导入导出时，    workflowMap.put(WfAware.DRAFT, wfService.getDraftById(bill.getProcessInstId()));    //获取实例    workflowMap.put(WfAware.INSTANCE, wfService.getInstanceById(bill.getProcessInstId()));    //获取action    workflowMap.put(WfAware.ACTION, wfService.getActionByinsId(bill.getProcessInstId()));    //获取待办任务    workflowMap.put(WfAware.TASK, wfService.getCurentTaskByInstanceId(bill.getProcessInstId()));        //获取历史审批信息    workflowMap.put(WfAware.HISTROY, wfService.getActionHistoryByIns(bill.getProcessInstId()));      //获取业务状态信息    workflowMap.put(WfAware.STATE_VALUE, wfService.getStateValueByIns(bill.getProcessInstId()));        bill.setWorkFlowMaps(workflowMap);        return bill;  }      public void insertWorkFlowInfo(ZcBaseBill bill,RequestMeta meta){    if(bill==null || bill.getProcessInstId()==null || bill.getWorkFlowMaps()==null)return;//    IZcEbBaseService baseService = (IZcEbBaseService) SpringContext.getBean("zcEbBaseService");    //暂不插入草稿数据，因为数据导入导出时，    DraftModel draft=(DraftModel) bill.getWorkFlowMaps().get(WfAware.DRAFT);    if(draft!=null){      zcEbBaseService.insertWithDelete("WFEngine.remove_Draft_byId", draft.getDraftId(), "DataExchange.create_Draft", draft, meta);    }    InstanceModel instance =(InstanceModel) bill.getWorkFlowMaps().get(WfAware.INSTANCE);    if(instance!=null){      zcEbBaseService.insertWithDelete("WFEngine.remove_Instance_byId", instance.getInstanceId(), "DataExchange.create_Instance", instance, meta);    }    List actionLst=(List)bill.getWorkFlowMaps().get(WfAware.ACTION);    if(actionLst!=null ){      for(int i=0;i<actionLst.size();i++){        ActionModel action=(ActionModel)actionLst.get(i);        zcEbBaseService.insertWithDelete("WFEngine.remove_Action", action, "DataExchange.create_Action", action, meta);      }       }    List taskLst=(List)bill.getWorkFlowMaps().get(WfAware.TASK);    if(taskLst!=null ){      for(int i=0;i<taskLst.size();i++){        CurrentTaskModel task=(CurrentTaskModel)taskLst.get(i);        zcEbBaseService.insertWithDelete("WFEngine.remove_currentTask", task, "DataExchange.create_CurrentTask", task, meta);      }       }    List historyLst=(List)bill.getWorkFlowMaps().get(WfAware.HISTROY);    if(historyLst!=null ){      for(int i=0;i<historyLst.size();i++){        ActionHistoryModel history=(ActionHistoryModel)historyLst.get(i);        zcEbBaseService.insertWithDelete("DataExchange.remove_ActionHistory", history, "DataExchange.create_ActionHistory", history, meta);      }       }    List stateValueLst=(List)bill.getWorkFlowMaps().get(WfAware.STATE_VALUE);    if(stateValueLst!=null ){      for(int i=0;i<stateValueLst.size();i++){        StateValueModel stateValue=(StateValueModel)stateValueLst.get(i);        zcEbBaseService.insertWithDelete("WFEngine.remove_StateValue", stateValue, "DataExchange.create_StateValue", stateValue, meta);      }       }  }  /**   * 获取用户对于的手机信息   * @param user 用户id   * @param entrustProcessInstid 鉴定委托的工作流实例ID PROCESS_INST_ID，电话信息   * @param meta   * @return 哈希表，key是电话号码，value用户   */  public HashMap getJdjgUser(String user,Long entrustProcessInstid,RequestMeta meta){	  HashMap rtn=new HashMap();	    IUserService userService = (IUserService) SpringContext.getBean("userService");	    SysEmp sm=userService.getSysEmp(user, ""+meta.getSvNd());	    if(sm.getAsEmp().getPhone()!=null && isMobile(sm.getAsEmp().getPhone())){	    	rtn.put(sm.getAsEmp().getPhone(), user);	    }	     	  return rtn;  }  /**   * 获取委托方送检人的电话信息    * @param entrustId   * @param meta   * @return   */  public HashMap getWtfSjrInfo(BigDecimal entrustId, RequestMeta meta) {	HashMap rtn=new HashMap(); //    IZcEbBaseService baseService = (IZcEbBaseService) SpringContext.getBean("zcEbBaseService");    ISfEntrustService sfEntrustService=(ISfEntrustService) SpringContext.getBean("sfEntrustService");        SfEntrust s=sfEntrustService.selectByPrimaryKey(entrustId, meta);        if(s.getSjrTel()!=null && isMobile(s.getSjrTel())){      rtn.put(s.getSjrTel(), s.getSjr()==null?"":s.getSjr());    }    if(s.getSjr2Tel()!=null && isMobile(s.getSjr2Tel())){      rtn.put(s.getSjr2Tel(), s.getSjr2()==null?"":s.getSjr2());    }     	return rtn;} public static boolean isMobile(String mobile) {	Pattern p = Pattern.compile("^((13[0-9])|(15[0-9])|(16[0-9])|(17[0-9])|(19[0-9])|(18[0,5-9]))\\d{8}$");  	  	Matcher m = p.matcher(mobile);  	  //	System.out.println(m.matches()+"---");  	  	return m.matches(); }public  void sendToBox(String appId,String sender,String content,String receiver,Date sendTime,Date inserTime ) {  //往发送表中发送数据//    IZcEbBaseService baseService = (IZcEbBaseService) SpringContext.getBean("zcEbBaseService");      SmsBoxsending sd = new SmsBoxsending();  SimpleDateFormat sdf = new SimpleDateFormat(ZcSettingConstants.SIMPLE_DATE_FORMAT_FULL);  sd.setAppid(appId);  sd.setSender(sender);  sd.setReceiver(receiver);  sd.setContent(content);  sd.setSendtime(sdf.format(sendTime));  sd.setInserttime(sdf.format(inserTime));  sd.setPri("1");  sd.setInpool("0");  sd.setSendmode("3");  zcEbBaseService.insertObject("ZcMobileMsgMapper.insertSmsBoxsending", sd); }/** * 根据指定的填空字符，将一个字符串补充到指定长度，如果源字符串超出了指定长度，则直接返回源字符串 * @param emptyChar 填空字符 * @param sourceStr 源字符串 * @param len 填充后字符串的长度 * @param isBack 字符填充位置，true:加到源字符串的后面；false:加到源字符串的前面 *  * @return 返回填充好的字符串 */	public String createFormatString(char emptyChar,String sourceStr,int len,boolean isBack){	  if(sourceStr==null || sourceStr.length()>=len){	    return sourceStr;	  }	  	  StringBuffer rtn=new StringBuffer();	  for(int i=0;i<len-sourceStr.length();i++){	    rtn.append(emptyChar);	  }	  if(isBack){	    sourceStr=sourceStr+rtn.toString();	  }else{	    sourceStr=rtn.append(sourceStr).toString();	  }	  return sourceStr;	} 	static Map asValsMap=new HashMap();	public static String getAsValName(String valSetId,String valId){	  String rtn=null;	  if(!asValsMap.containsKey(valSetId)){	    IAsValService asValService =(IAsValService)SpringContext.getBean("asValService");	    List asValLst=asValService.getAsVal(valSetId);	    if(asValLst==null)return null;	    asValsMap.put(valSetId, asValLst);	  }	  List asValLst=(List) asValsMap.get(valSetId);	  for(int i=0;i<asValLst.size();i++){	    AsVal av=(AsVal) asValLst.get(i);	    if(av.getValId().equals(valId)){	      return av.getVal();	    }	  }	  return rtn;	}  public String getSjrInfo(SfEntrust entrust, RequestMeta requestMeta) {    StringBuffer sb=new StringBuffer();    sb.append("");     boolean f=false;    if(entrust.getSjr()!=null){      sb.append(entrust.getSjr());      f=true;    }    if(entrust.getSjr2()!=null){      if(f){        sb.append("、");      }      sb.append(entrust.getSjr2());    }    sb.append("先生您好，您送交的司法鉴定(委托编号:").append(entrust.getCode()).append(",").append(entrust.getName()).append("),");        return sb.toString();  }  public static SfJdjg getJdjgInfo(String coCode) {        if(jdjgLst.size()==0){      ElementConditionDto dto=new ElementConditionDto();       jdjgLst= zcEbBaseService.queryDataForList("com.ufgov.zc.server.sf.dao.SfJdjgMapper.selectMainDataLst", dto);    }    if(jdjgLst==null){      jdjgLst=new ArrayList();    }    for(int i=0;i<jdjgLst.size();i++){      SfJdjg jgJdjg=(SfJdjg)jdjgLst.get(i);      if(jgJdjg.getCoCode().equals(coCode)){        return jgJdjg;      }    }    return null;  }  public void sendMsgToSjr(SfEntrust bill, String msg) {    Date d=new Date();    if(bill.getSjrTel()!=null && isMobile(bill.getSjrTel())){      sendToBox(""+bill.getEntrustId().intValue(), "", msg, bill.getSjrTel(), d,d);    }    if(bill.getSjr2Tel()!=null && isMobile(bill.getSjr2Tel())){      sendToBox(""+bill.getEntrustId().intValue(), "", msg, bill.getSjr2Tel(), d,d);    }  }   public void sendMsgToJdjgLeader(SfEntrust bill, String msg) {      }  public List getKeshiShouLiUser(SfEntrust qx, RequestMeta requestMeta) {    List rtn=new ArrayList();    ElementConditionDto dto=new ElementConditionDto();    dto.setDattr1("SF_ENTRUST");    dto.setDattr2(""+qx.getProcessInstId());//    IZcEbBaseService zcEbBaseService=(IZcEbBaseService)SpringContext.getBean("zcEbBaseService");    List t=zcEbBaseService.queryDataForList("ZcEbUtil.selectEntrustKeshiShouliToDoUser", dto);     if(t==null)return rtn;    for(int i=0;i<t.size();i++){      HashMap row=(HashMap) t.get(i);      rtn.add(row.get("EXECUTOR"));    }    return rtn;      }  public List getZonheShouLiUser(SfEntrust qx, RequestMeta requestMeta) {    List rtn=new ArrayList();    ElementConditionDto dto=new ElementConditionDto();    dto.setDattr1("SF_ENTRUST");    dto.setDattr2(""+qx.getProcessInstId());//    IZcEbBaseService zcEbBaseService=(IZcEbBaseService)SpringContext.getBean("zcEbBaseService");    List t=zcEbBaseService.queryDataForList("ZcEbUtil.selectEntrustZongheShouliToDoUser", dto);     if(t==null)return rtn;    for(int i=0;i<t.size();i++){      HashMap row=(HashMap) t.get(i);      rtn.add(row.get("EXECUTOR"));    }    return rtn;      }  public List getZonheShouLiUser(int nd,String jdjgCode) {    List rtn=new ArrayList();    ElementConditionDto dto=new ElementConditionDto();    dto.setNd(nd);    dto.setCoCode(jdjgCode); //    IZcEbBaseService zcEbBaseService=(IZcEbBaseService)SpringContext.getBean("zcEbBaseService");    List t=zcEbBaseService.queryDataForList("ZcEbUtil.selectZongheShouliUser", dto);     if(t==null)return rtn;    for(int i=0;i<t.size();i++){      HashMap row=(HashMap) t.get(i);      rtn.add(row.get("USER_ID"));    }    return rtn;      }  public void sendMsgToUser(List userLst, String msg) {    ElementConditionDto dto=new ElementConditionDto();    dto.getPmAdjustCodeList().clear();    dto.getPmAdjustCodeList().addAll(userLst);    dto.setDattr1("havePhone");    userLst=zcEbBaseService.queryDataForList("AsEmp.getAsEmpLst", dto);         if(userLst==null || userLst.size()==0)return;    sendMsgToAsEmp(userLst,msg);  }  public void sendMsgToAsEmp(List empLst, String msg) {    if(empLst==null || msg==null)return;    Date d=new Date();    for(int i=0;i<empLst.size();i++){      AsEmp emp=(AsEmp) empLst.get(i);      sendToBox("", "", msg, emp.getPhone(), d, d);    }  }  public String getSfEntrustAcceptCode(SfEntrust bill,WorkflowContext context){    return getSfEntrustAcceptCode(bill);  }  public String getSfEntrustAcceptCode(SfEntrust bill){    IZcEbBaseService baseService = (IZcEbBaseService) SpringContext.getBean("zcEbBaseService");    String compoId="SF_ENTRUST";    if(bill.getCoCode()==null || bill.getCoCode().equals("000")){      compoId="SF_ENTRUST";    }else{      compoId="SF_ENTRUST"+bill.getCoCode();    }         String acceptCode = baseService.getAutoNumNo(bill, compoId, "CODE");        return acceptCode;  }  public static Date getSysDate(){    return new Date();  }  }